<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mesa_geo.raster_layers &#8212; Mesa-Geo 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Vibur" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyterlite_sphinx.css?v=ca70e7f1" />
    <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/jupyterlite_sphinx.js?v=d6bdf5f8"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />





  </head><body>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">


          <div class="body" role="main">

  <h1>Source code for mesa_geo.raster_layers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Raster Layers</span>
<span class="sd">-------------</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">overload</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">from</span> <span class="nn">affine</span> <span class="kn">import</span> <span class="n">Affine</span>
<span class="kn">from</span> <span class="nn">mesa.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">mesa.space</span> <span class="kn">import</span> <span class="n">Coordinate</span><span class="p">,</span> <span class="n">accept_tuple_argument</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Resampling</span><span class="p">,</span>
    <span class="n">calculate_default_transform</span><span class="p">,</span>
    <span class="n">reproject</span><span class="p">,</span>
    <span class="n">transform_bounds</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">mesa_geo.geo_base</span> <span class="kn">import</span> <span class="n">GeoBase</span>


<div class="viewcode-block" id="RasterBase">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterBase">[docs]</a>
<span class="k">class</span> <span class="nc">RasterBase</span><span class="p">(</span><span class="n">GeoBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for raster layers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_width</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_height</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_transform</span><span class="p">:</span> <span class="n">Affine</span>
    <span class="n">_total_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># [min_x, min_y, max_x, max_y]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a raster base layer.</span>

<span class="sd">        :param width: Width of the raster base layer.</span>
<span class="sd">        :param height: Height of the raster base layer.</span>
<span class="sd">        :param crs: Coordinate reference system of the raster base layer.</span>
<span class="sd">        :param total_bounds: Bounds of the raster base layer in [min_x, min_y, max_x, max_y] format.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_bounds</span> <span class="o">=</span> <span class="n">total_bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the width of the raster base layer.</span>

<span class="sd">        :return: Width of the raster base layer.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span>

    <span class="nd">@width</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the width of the raster base layer.</span>

<span class="sd">        :param int width: Width of the raster base layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the height of the raster base layer.</span>

<span class="sd">        :return: Height of the raster base layer.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span>

    <span class="nd">@height</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the height of the raster base layer.</span>

<span class="sd">        :param int height: Height of the raster base layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_bounds</span>

    <span class="nd">@total_bounds</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">total_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the bounds of the raster base layer in [min_x, min_y, max_x, max_y] format.</span>

<span class="sd">        :param np.ndarray total_bounds: Bounds of the raster base layer in [min_x, min_y, max_x, max_y] format.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_total_bounds</span> <span class="o">=</span> <span class="n">total_bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Affine</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the affine transformation of the raster base layer.</span>

<span class="sd">        :return: Affine transformation of the raster base layer.</span>
<span class="sd">        :rtype: Affine</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the (width, height) of a cell in the units of CRS.</span>

<span class="sd">        :return: Width and height of a cell in the units of CRS.</span>
<span class="sd">        :rtype: Tuple[float, float]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="p">)</span>

<div class="viewcode-block" id="RasterBase.to_crs">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterBase.to_crs">[docs]</a>
    <span class="k">def</span> <span class="nf">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RasterBase</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="RasterBase.out_of_bounds">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterBase.out_of_bounds">[docs]</a>
    <span class="k">def</span> <span class="nf">out_of_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="n">Coordinate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines whether position is off the grid.</span>

<span class="sd">        :param Coordinate pos: Position to check.</span>
<span class="sd">        :return: True if position is off the grid, False otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span></div>
</div>



<div class="viewcode-block" id="Cell">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.Cell">[docs]</a>
<span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cells are containers of raster attributes, and are building blocks of `RasterLayer`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pos</span><span class="p">:</span> <span class="n">Coordinate</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">indices</span><span class="p">:</span> <span class="n">Coordinate</span> <span class="o">|</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a cell.</span>

<span class="sd">        :param pos: Position of the cell in (x, y) format.</span>
<span class="sd">            Origin is at lower left corner of the grid</span>
<span class="sd">        :param indices: Indices of the cell in (row, col) format.</span>
<span class="sd">            Origin is at upper left corner of the grid</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span>

<div class="viewcode-block" id="Cell.step">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.Cell.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="RasterLayer">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer">[docs]</a>
<span class="k">class</span> <span class="nc">RasterLayer</span><span class="p">(</span><span class="n">RasterBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some methods in `RasterLayer` are copied from `mesa.space.Grid`, including:</span>

<span class="sd">    __getitem__</span>
<span class="sd">    __iter__</span>
<span class="sd">    coord_iter</span>
<span class="sd">    iter_neighborhood</span>
<span class="sd">    get_neighborhood</span>
<span class="sd">    iter_neighbors</span>
<span class="sd">    get_neighbors  # copied and renamed to `get_neighboring_cells`</span>
<span class="sd">    out_of_bounds  # copied into `RasterBase`</span>
<span class="sd">    iter_cell_list_contents</span>
<span class="sd">    get_cell_list_contents</span>

<span class="sd">    Methods from `mesa.space.Grid` that are not copied over:</span>

<span class="sd">    torus_adj</span>
<span class="sd">    neighbor_iter</span>
<span class="sd">    move_agent</span>
<span class="sd">    place_agent</span>
<span class="sd">    _place_agent</span>
<span class="sd">    remove_agent</span>
<span class="sd">    is_cell_empty</span>
<span class="sd">    move_to_empty</span>
<span class="sd">    find_empty</span>
<span class="sd">    exists_empty_cells</span>

<span class="sd">    Another difference is that `mesa.space.Grid` has `self.grid: List[List[Agent | None]]`,</span>
<span class="sd">    whereas it is `self.cells: List[List[Cell]]` here in `RasterLayer`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cells</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]]</span>
    <span class="n">_neighborhood_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">]]</span>
    <span class="n">_attributes</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="p">,</span> <span class="n">cell_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_cls</span> <span class="o">=</span> <span class="n">cell_cls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
            <span class="n">col</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">cell_cls</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
                <span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span>
                <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_cls</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">indices</span><span class="o">=</span><span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the attributes of the cells in the raster layer.</span>

<span class="sd">        :return: Attributes of the cells in the raster layer.</span>
<span class="sd">        :rtype: Set[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cell</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cell</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access contents from the grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># cells[x]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># cells[(x1, y1), (x2, y2)]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">],</span> <span class="n">index</span><span class="p">)</span>

            <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">pos</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x1</span><span class="p">][</span><span class="n">y1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">cells</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">index</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># cells[x, y]</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Coordinate</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># cells[x, :]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># grid[:, y]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># cells[:, :]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">slice</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">cast</span><span class="p">(</span><span class="nb">slice</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="n">y</span><span class="p">]:</span>
                <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cells</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an iterator that chains the rows of the cells together</span>
<span class="sd">        as if it is one list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>

<div class="viewcode-block" id="RasterLayer.coord_iter">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.coord_iter">[docs]</a>
    <span class="k">def</span> <span class="nf">coord_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Cell</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An iterator that returns coordinates as well as cell contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">],</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span>  <span class="c1"># cell, x, y</span></div>


<div class="viewcode-block" id="RasterLayer.apply_raster">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.apply_raster">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_raster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply raster data to the cells.</span>

<span class="sd">        :param np.ndarray data: 2D numpy array with shape (1, height, width).</span>
<span class="sd">        :param str | None attr_name: Name of the attribute to be added to the cells.</span>
<span class="sd">            If None, a random name will be generated. Default is None.</span>
<span class="sd">        :raises ValueError: If the shape of the data is not (1, height, width).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Data shape does not match raster shape. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="si">}</span><span class="s2">, received </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attr_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;attribute_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">],</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span></div>


<div class="viewcode-block" id="RasterLayer.get_raster">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.get_raster">[docs]</a>
    <span class="k">def</span> <span class="nf">get_raster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the values of given attribute.</span>

<span class="sd">        :param str | None attr_name: Name of the attribute to be returned. If None,</span>
<span class="sd">            returns all attributes. Default is None.</span>
<span class="sd">        :return: The values of given attribute as a 2D numpy array with shape (1, height, width).</span>
<span class="sd">        :rtype: np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">attr_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> does not exist. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Choose from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="si">}</span><span class="s2">, or set `attr_name` to `None` to retrieve all.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
            <span class="n">attr_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_bands</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">attr_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">attr_name</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_bands</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">attr_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="RasterLayer.iter_neighborhood">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.iter_neighborhood">[docs]</a>
    <span class="k">def</span> <span class="nf">iter_neighborhood</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">:</span> <span class="n">Coordinate</span><span class="p">,</span>
        <span class="n">moore</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an iterator over cell coordinates that are in the</span>
<span class="sd">        neighborhood of a certain point.</span>

<span class="sd">        :param Coordinate pos: Coordinate tuple for the neighborhood to get.</span>
<span class="sd">        :param bool moore: Whether to use Moore neighborhood or not. If True,</span>
<span class="sd">            return Moore neighborhood (including diagonals). If False, return</span>
<span class="sd">            Von Neumann neighborhood (exclude diagonals).</span>
<span class="sd">        :param bool include_center: If True, return the (x, y) cell as well.</span>
<span class="sd">            Otherwise, return surrounding cells only. Default is False.</span>
<span class="sd">        :param int radius: Radius, in cells, of the neighborhood. Default is 1.</span>
<span class="sd">        :return: An iterator over cell coordinates that are in the neighborhood.</span>
<span class="sd">            For example with radius 1, it will return list with number of elements</span>
<span class="sd">            equals at most 9 (8) if Moore, 5 (4) if Von Neumann (if not including</span>
<span class="sd">            the center).</span>
<span class="sd">        :rtype: Iterator[Coordinate]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">moore</span><span class="p">,</span> <span class="n">include_center</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span></div>


<div class="viewcode-block" id="RasterLayer.iter_neighbors">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.iter_neighbors">[docs]</a>
    <span class="k">def</span> <span class="nf">iter_neighbors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">:</span> <span class="n">Coordinate</span><span class="p">,</span>
        <span class="n">moore</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an iterator over neighbors to a certain point.</span>

<span class="sd">        :param Coordinate pos: Coordinate tuple for the neighborhood to get.</span>
<span class="sd">        :param bool moore: Whether to use Moore neighborhood or not. If True,</span>
<span class="sd">            return Moore neighborhood (including diagonals). If False, return</span>
<span class="sd">            Von Neumann neighborhood (exclude diagonals).</span>
<span class="sd">        :param bool include_center: If True, return the (x, y) cell as well.</span>
<span class="sd">            Otherwise, return surrounding cells only. Default is False.</span>
<span class="sd">        :param int radius: Radius, in cells, of the neighborhood. Default is 1.</span>
<span class="sd">        :return: An iterator of cells that are in the neighborhood; at most 9 (8)</span>
<span class="sd">            if Moore, 5 (4) if Von Neumann (if not including the center).</span>
<span class="sd">        :rtype: Iterator[Cell]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">neighborhood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">moore</span><span class="p">,</span> <span class="n">include_center</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_cell_list_contents</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span></div>


    <span class="nd">@accept_tuple_argument</span>
    <span class="k">def</span> <span class="nf">iter_cell_list_contents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator of the contents of the cells</span>
<span class="sd">        identified in cell_list.</span>

<span class="sd">        :param Iterable[Coordinate] cell_list: Array-like of (x, y) tuples,</span>
<span class="sd">            or single tuple.</span>
<span class="sd">        :return: An iterator of the contents of the cells identified in cell_list.</span>
<span class="sd">        :rtype: Iterator[Cell]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Note: filter(None, iterator) filters away an element of iterator that</span>
        <span class="c1"># is falsy. Hence, iter_cell_list_contents returns only non-empty</span>
        <span class="c1"># contents.</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cell_list</span><span class="p">))</span>

    <span class="nd">@accept_tuple_argument</span>
    <span class="k">def</span> <span class="nf">get_cell_list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the contents of the cells</span>
<span class="sd">        identified in cell_list.</span>

<span class="sd">        Note: this method returns a list of cells.</span>

<span class="sd">        :param Iterable[Coordinate] cell_list: Array-like of (x, y) tuples,</span>
<span class="sd">            or single tuple.</span>
<span class="sd">        :return: A list of the contents of the cells identified in cell_list.</span>
<span class="sd">        :rtype: List[Cell]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_cell_list_contents</span><span class="p">(</span><span class="n">cell_list</span><span class="p">))</span>

<div class="viewcode-block" id="RasterLayer.get_neighborhood">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.get_neighborhood">[docs]</a>
    <span class="k">def</span> <span class="nf">get_neighborhood</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">:</span> <span class="n">Coordinate</span><span class="p">,</span>
        <span class="n">moore</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">]:</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">moore</span><span class="p">,</span> <span class="n">include_center</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="n">neighborhood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">neighborhood</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coordinates</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Coordinate</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="k">for</span> <span class="n">dy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">dx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dy</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_center</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># Skip coordinates that are outside manhattan distance</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">moore</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">radius</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_of_bounds</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">coordinates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="n">neighborhood</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">neighborhood</span>

        <span class="k">return</span> <span class="n">neighborhood</span></div>


<div class="viewcode-block" id="RasterLayer.get_neighboring_cells">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.get_neighboring_cells">[docs]</a>
    <span class="k">def</span> <span class="nf">get_neighboring_cells</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">:</span> <span class="n">Coordinate</span><span class="p">,</span>
        <span class="n">moore</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">include_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Cell</span><span class="p">]:</span>
        <span class="n">neighboring_cell_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">moore</span><span class="p">,</span> <span class="n">include_center</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">neighboring_cell_idx</span><span class="p">]</span></div>


<div class="viewcode-block" id="RasterLayer.to_crs">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.to_crs">[docs]</a>
    <span class="k">def</span> <span class="nf">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RasterLayer</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_to_crs_check</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">is_exact_same</span><span class="p">(</span><span class="n">crs</span><span class="p">):</span>
            <span class="n">transform</span><span class="p">,</span> <span class="n">dst_width</span><span class="p">,</span> <span class="n">dst_height</span> <span class="o">=</span> <span class="n">calculate_default_transform</span><span class="p">(</span>
                <span class="n">src_crs</span><span class="p">,</span>
                <span class="n">dst_crs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="o">*</span><span class="n">layer</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_total_bounds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="o">*</span><span class="n">transform_bounds</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="o">*</span><span class="n">layer</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">transform</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">layer</span></div>


<div class="viewcode-block" id="RasterLayer.to_image">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.to_image">[docs]</a>
    <span class="k">def</span> <span class="nf">to_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colormap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageLayer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an ImageLayer colored by the provided colormap.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">indices</span>
            <span class="n">values</span><span class="p">[:,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ImageLayer</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">)</span></div>


<div class="viewcode-block" id="RasterLayer.from_file">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.from_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">raster_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cell_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RasterLayer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a RasterLayer from a raster file.</span>

<span class="sd">        :param str raster_file: Path to the raster file.</span>
<span class="sd">        :param Type[Cell] cell_cls: The class of the cells in the layer.</span>
<span class="sd">        :param str | None attr_name: The name of the attribute to use for the cell values.</span>
<span class="sd">            If None, a random name will be generated. Default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">total_bounds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="p">,</span> <span class="n">cell_cls</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transform</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">apply_raster</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">attr_name</span><span class="o">=</span><span class="n">attr_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="RasterLayer.to_file">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.RasterLayer.to_file">[docs]</a>
    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raster_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">driver</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GTiff&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a raster layer to a file.</span>

<span class="sd">        :param str raster_file: The path to the raster file to write to.</span>
<span class="sd">        :param str | None attr_name: The name of the attribute to write to the raster.</span>
<span class="sd">            If None, all attributes are written. Default is None.</span>
<span class="sd">        :param str driver: The GDAL driver to use for writing the raster file.</span>
<span class="sd">            Default is &#39;GTiff&#39;. See GDAL docs at https://gdal.org/drivers/raster/index.html.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raster</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="n">raster_file</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="n">count</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ImageLayer">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.ImageLayer">[docs]</a>
<span class="k">class</span> <span class="nc">ImageLayer</span><span class="p">(</span><span class="n">RasterBase</span><span class="p">):</span>
    <span class="n">_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an ImageLayer.</span>

<span class="sd">        :param values: The values of the image layer.</span>
<span class="sd">        :param crs: The coordinate reference system of the image layer.</span>
<span class="sd">        :param total_bounds: The bounds of the image layer in [min_x, min_y, max_x, max_y] format.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">height</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">total_bounds</span><span class="o">=</span><span class="n">total_bounds</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the values of the image layer.</span>

<span class="sd">        :return: The values of the image layer.</span>
<span class="sd">        :rtype: np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span>

    <span class="nd">@values</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values of the image layer.</span>

<span class="sd">        :param np.ndarray values: The values of the image layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>

<div class="viewcode-block" id="ImageLayer.to_crs">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.ImageLayer.to_crs">[docs]</a>
    <span class="k">def</span> <span class="nf">to_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageLayer</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_to_crs_check</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_user_input</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">is_exact_same</span><span class="p">(</span><span class="n">crs</span><span class="p">):</span>
            <span class="n">num_bands</span><span class="p">,</span> <span class="n">src_height</span><span class="p">,</span> <span class="n">src_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">transform</span><span class="p">,</span> <span class="n">dst_width</span><span class="p">,</span> <span class="n">dst_height</span> <span class="o">=</span> <span class="n">calculate_default_transform</span><span class="p">(</span>
                <span class="n">src_crs</span><span class="p">,</span>
                <span class="n">dst_crs</span><span class="p">,</span>
                <span class="n">src_width</span><span class="p">,</span>
                <span class="n">src_height</span><span class="p">,</span>
                <span class="o">*</span><span class="n">layer</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_bands</span><span class="p">,</span> <span class="n">dst_height</span><span class="p">,</span> <span class="n">dst_width</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="n">reproject</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">band</span><span class="p">,</span>
                    <span class="n">destination</span><span class="o">=</span><span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">src_transform</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                    <span class="n">src_crs</span><span class="o">=</span><span class="n">src_crs</span><span class="p">,</span>
                    <span class="n">dst_transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                    <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
                    <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_total_bounds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="o">*</span><span class="n">transform_bounds</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="o">*</span><span class="n">layer</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">layer</span></div>


<div class="viewcode-block" id="ImageLayer.from_file">
<a class="viewcode-back" href="../../apis/raster_layers.html#mesa_geo.raster_layers.ImageLayer.from_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageLayer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an ImageLayer from an image file.</span>

<span class="sd">        :param image_file: The path to the image file.</span>
<span class="sd">        :return: The ImageLayer.</span>
<span class="sd">        :rtype: ImageLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">total_bounds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">total_bounds</span><span class="o">=</span><span class="n">total_bounds</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transform</span>
            <span class="k">return</span> <span class="n">obj</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(crs=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="si">}</span><span class="s2">, total_bounds=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_bounds</span><span class="si">}</span><span class="s2">, values=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="si">!r}</span><span class="s2">)&quot;</span></div>

</pre></div>

          </div>

        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Mesa-Geo</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/overview.html">Introductory Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/overview.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apis/api_main.html">API Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2017-2024, Project Mesa-Geo Team.

      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>

    </div>




  </body>
</html>